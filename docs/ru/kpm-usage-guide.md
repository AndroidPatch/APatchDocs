
# Руководство по использованию KPModule

APatch основан на KernelPatch, он наследует все его функциональные возможности и был расширен. Следовательно, APatch также поддерживает модули KernelPatch (KPM). Вот введение об использовании KPM.

## Что такое KPM?

Модули KernelPatch (KPM) - это тип модулей, который позволяет коду выполняться в пространстве ядра, подобно загружаемым модулям ядра (LKM). Они могут выполнять некоторые операции, которые APM не могут делать (например, защита образов разделов). ~~Вы даже можете изменить ksud KernelSU на KPM, чтобы разрешить KernelSU работать на APatch~~.

## Как использовать KPM?

Существует 3 способа использования KPM: Встраивание, Загрузка и Установка.

::: tip О "Установке"
Этот документ последний раз обновлялся 06.08.2024 в 19:14. Будьте осторожны при доступе к содержимому этой страницы, если разница во времени с настоящим слишком велика.

В настоящее время APatch не реализовал функцию "Установка" для KPM, и вы можете использовать KPM только с помощью "Встраивания" и "Загрузки". Разработчики KernelPatch и APatch работают над быстрой реализацией функции "Установка". Пожалуйста, наберитесь терпения.
:::

### Встраивание

`Встраивание` - это функция, которая встраивает KPM непосредственно в `ядро`. KPM, установленные таким образом, будут объединены вместе с пропатченным `ядром` в `boot.img` и будут загружены на этапе загрузки `pre-kernel-init`.

Встраивание KPM может быть выполнено как при первом патчинге `boot.img`, так и после установки APatch.

#### Встраивание KPM при первом патчинге {#embed-kpms-at-first-patching}

1. [Пропатчите](/ru/install#patch) ваш `boot.img`, следуя руководству по [Автоматическому патчингу](/ru/install#automatically-patching). После завершения шага 4 не переходите сразу к следующему шагу.
2. Нажмите кнопку "Embed KPM" и выберите KPM, который вы хотите встроить (Расширение файлов KPM - `.kpm`).
3. Убедитесь, что KPM - это тот KPM, который вы хотите встроить.
4. Завершите остальные шаги в руководстве по "Автоматическому патчингу", и все будет сделано.

#### Встраивание KPM после установки APatch

После установки APatch способ встраивания KPM аналогичен установке APM. Вы можете нажать кнопку в правом нижнем углу и выбрать "Embed". Оставшиеся шаги можно найти в разделе [Встраивание KPM при первом патчинге](/ru/kpm-usage-guide#embed-kpms-at-first-patching).

### Загрузка

`Загрузка` - это функция, которая позволяет ядру загружать KPM напрямую. KPM, установленные таким образом, будут загружены немедленно. Однако все загруженные KPM будут потеряны после следующей перезагрузки.

Способ загрузки KPM аналогичен установке APM; единственное отличие состоит в том, что вам не нужно перезагружать устройство после загрузки KPM.

### Установка

::: tip Внимание
KernelPatch и APatch еще не реализовали функцию "Установка" для KPM. Все описания ниже являются предположительными и описывают ожидаемое поведение "Установки" для KPM.
:::

`Установка` - это функция, которая устанавливает KPM аналогично файлам APM в `/data/adb/kpmodules` или любые подобные каталоги. KPM, установленные таким образом, могут быть загружены во время специальных событий.