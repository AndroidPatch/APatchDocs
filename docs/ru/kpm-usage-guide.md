# Руководство по использованию модуля KPModule

APatch опирается на KernelPatch, он унаследовал все его функциональные возможности и был расширен. Поэтому APatch также поддерживает модули KernelPatch (KPM). Вот введение об использовании KPM.

## Что такое KPM?

KernelPatch Modules (KPM) - это тип модуля, который позволяет выполнять код в пространстве ядра, подобно загружаемым модулям ядра (Loadable Kernel Modules, LKM). Они могут выполнять некоторые операции, которые APM не могут делать (например, защита образа раздела). ~~Вы даже можете модифицировать ksud KernelSU в KPM, чтобы позволить KernelSU работать на APatch~~.

## Как использовать KPM?

Существует 3 способа использования KPM: Встраивание, Загрузка и Установка.

::: tip Об "установке"
Последний раз этот документ был обновлен 2024-06-21 в 23:12. Следует соблюдать осторожность при обращении к содержимому этой страницы, если разница во времени с настоящим моментом слишком велика.

В настоящее время APatch не реализовал функцию "Install" для KPM, и вы можете использовать KPM только через "Embed" и "Load". KernelPatch и разработчики APatch быстро над реализацией функции "Установить". Пожалуйста, терпеливо ожидайте.
:::

### Встраивание (Embed)

Встраивание - это функция, которая встраивает KPM непосредственно в `kernel` (ядро). KPM, установленные таким образом, будут слиты вместе с патченным `kernel` в `boot.img`, и будут загружены на этапе загрузки `pre-kernel-init`.

Встраивание KPM может быть выполнено как при первом патче `boot.img`, так и после установки APatch.

#### Встраивание KPM при первом патче {#embed-kpms-at-first-patching}

1. [Пропатчите](/ru/patch) ваш `boot.img` следуя руководству [Автоматический патчинг](/ru/patch#automatically-patching). После выполнения шага 4 не переходите сразу к следующему шагу.

2. Нажмите кнопку "Встроить KPM" и выберите KPM, который вы хотите встроить (расширение файлов KPM - `.kpm`).

3. Подтвердите, что выбранный KPM - это тот KPM, который вы хотите внедрить.

4.  Выполните остальные шаги в руководстве "Автоматический патчинг", и все будет готово.

#### Встраивание KPM после установки APatch

После установки APatch способ встраивания KPMs похож на установку APM ("обычных" модулей). Вы можете нажать на кнопку в правом нижнем углу и выбрать "Встраивание". Остальные шаги описаны в [Встраивание KPM при первом патче](/ru/kpm-usage-guide#embed-kpms-at-first-patching).

### Загрузка (Load)

Загрузка - это функция, позволяющая ядру загружать KPM напрямую. KPM, установленные таким образом, будут загружены немедленно. Однако все загруженные KPM будут потеряны после следующей перезагрузки.

Способ загрузки KPMs похож на установку APM, единственное отличие - вам не нужно перезагружать устройство после загрузки KPMs.

### Установка (Install)

::: tip Внимание!
KernelPatch и APatch еще не реализовали функцию "Установить" для KPM. Всё описание ниже являются примерным и описывают ожидаемое поведение функции "Установки" для KPM.
:::

"Установка" - это функция, которая устанавливает KPM, аналогичные APM-файлам, в `/data/adb/kpmodules` или любые другие подобные директории. KPM, установленные таким образом, могут быть загружены во время специальных событий.